"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Shibboleth {
    constructor(shibURL) {
        this._shibURL = shibURL;
        if (!this._shibURL.endsWith("?target=")) {
            this._shibURL = `${this._shibURL}?target=`;
        }
    }
    hasShibSessionInfo(req, headers) {
        if (headers != null && headers.length > 0) {
            for (let i = 0; i < headers.length; i++) {
                if (req.headers[headers[i]] != null) {
                    return true;
                }
            }
        }
        if (req.headers["http_shibsessionid"] != null || req.headers["x-iisnode-http_shibsessionid"] != null) {
            return true;
        }
        return false;
    }
    shouldRedirect(req) {
        if (!this.hasShibSessionInfo(req)) {
            return true;
        }
        return false;
    }
    redirect(req, res, next) {
        res.redirect(301, `${this._shibURL}${req.url}`, next);
    }
}
exports.Shibboleth = Shibboleth;
function shibboleth(req, res, next) {
    const shib = new Shibboleth(process.env.SHIBBOLETHURL);
    if (shib.shouldRedirect(req)) {
        shib.redirect(req, res, next);
    }
    next();
}
exports.shibboleth = shibboleth;
//# sourceMappingURL=shibboleth.js.map